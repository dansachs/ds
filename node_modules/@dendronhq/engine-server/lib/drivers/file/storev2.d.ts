import { BulkAddNoteOpts, DendronConfig, DEngineClient, DEngineDeleteSchemaResp, DEngineInitResp, DEngineInitSchemaResp, DLink, DNoteAnchorPositioned, DStore, DVault, EngineDeleteOptsV2, EngineUpdateNodesOptsV2, EngineWriteOptsV2, NoteChangeEntry, NoteProps, NotePropsDict, NotesCache, NotesCacheAll, NotesCacheEntryMap, RenameNoteOpts, RenameNotePayload, SchemaModuleDict, SchemaModuleProps, StoreDeleteNoteResp, WriteNoteResp } from "@dendronhq/common-all";
import { DLogger } from "@dendronhq/common-server";
export declare type FileMeta = {
    prefix: string;
    fpath: string;
};
export declare type FileMetaDict = {
    [key: string]: FileMeta[];
};
export declare class FileStorage implements DStore {
    vaults: DVault[];
    notes: NotePropsDict;
    schemas: SchemaModuleDict;
    notesCache: NotesCache;
    logger: DLogger;
    links: DLink[];
    anchors: DNoteAnchorPositioned[];
    wsRoot: string;
    configRoot: string;
    config: DendronConfig;
    private engine;
    constructor(props: {
        engine: DEngineClient;
        logger: DLogger;
    });
    init(): Promise<DEngineInitResp>;
    deleteNote(id: string, opts?: EngineDeleteOptsV2): Promise<StoreDeleteNoteResp>;
    deleteSchema(id: string, opts?: EngineDeleteOptsV2): Promise<DEngineDeleteSchemaResp>;
    initSchema(): Promise<DEngineInitSchemaResp>;
    _initSchema(vault: DVault): Promise<{
        data: SchemaModuleProps[];
        errors: any[];
    }>;
    initNotes(): Promise<NoteProps[]>;
    _addBacklinks({ notesWithLinks, allNotes, }: {
        notesWithLinks: NoteProps[];
        allNotes: NoteProps[];
        allNotesCache: NotesCacheAll;
    }): Promise<Promise<(void[] | undefined)[] | undefined>[]>;
    _initNotes(vault: DVault): Promise<{
        notes: NoteProps[];
        cacheUpdates: NotesCacheEntryMap;
        cache: NotesCache;
    }>;
    bulkAddNotes(opts: BulkAddNoteOpts): Promise<{
        error: null;
        data: NoteChangeEntry[];
    }>;
    renameNote(opts: RenameNoteOpts): Promise<RenameNotePayload>;
    updateNote(note: NoteProps, opts?: EngineUpdateNodesOptsV2): Promise<NoteProps>;
    updateSchema(schemaModule: SchemaModuleProps): Promise<void>;
    _writeNewNote({ note, maybeNote, opts, }: {
        note: NoteProps;
        maybeNote?: NoteProps;
        opts?: EngineWriteOptsV2;
    }): Promise<NoteProps[]>;
    writeNote(note: NoteProps, opts?: EngineWriteOptsV2): Promise<WriteNoteResp>;
    writeSchema(schemaModule: SchemaModuleProps): Promise<void>;
}
